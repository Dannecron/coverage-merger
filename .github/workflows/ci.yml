---
name: ci

on:
  workflow_dispatch:
  push:
    branches:
      - '**'

jobs:
  tests:
    runs-on: ubuntu-22.04
    strategy:
      matrix:
        php_version: ['8.1', '8.2']
        prefer_lowest: ['yes', '']
    container: dannecron/php-for-dev:${{ matrix.php_version }}
    steps:
      - name: Check out repository
        uses: actions/checkout@v3
      - name: Init composer.lock
        run: |
          composer update --no-install $(if [[ "${{ matrix.prefer_lowest }}" == 'yes' ]]; then echo '--prefer-lowest'; fi)
      - name: Install dependencies
        run: composer install
      - name: Run tests
        run: composer run pest-coverage
  lint:
    runs-on: ubuntu-22.04
    strategy:
      matrix:
        php_version: ['80100', '80200']
    container: dannecron/php-for-dev:8.2
    steps:
      - name: Check out repository
        uses: actions/checkout@v3
      - name: Init composer.lock and install dependencies
        run: composer update
      - name: Run phpcs
        run: vendor/bin/phpcs --standard=phpcs.xml --report=full --config-set php_version ${{ matrix.php_version }} ./src ./tests
